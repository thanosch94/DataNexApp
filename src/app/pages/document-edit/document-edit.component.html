<dn-toolbar
  [canDelete]="true"
  [canRefresh]="documentId ? true : false"
  [canExit]="true"
  [canSave]="true"
  [canTransform]="documentId ? true : false"
  [canPrint]="documentId ? true : false"
  [isDialog]="false"
  [title]="document_text"
  [entityId]="document.Id"
  (onCloseBtnClicked)="onCloseClicked($event)"
  (onDeleteBtnClicked)="onDeleteClicked($event)"
  (onSaveBtnClicked)="onSaveClicked($event)"
  (onRefreshBtnClicked)="onRefreshClicked($event)"
  (onPrintBtnClicked)="onPrintClicked($event)"
  (onTransformedBtnClicked)="onTransformClicked($event)"
></dn-toolbar>
@if(document && columns){
<form class="form">
  <mat-tab-group>
    <mat-tab label="Basic Info">
      <div class="tab-1">
        <div class="tab1-grid">
          <div class="tab1-grid-a">
            <dn-selectbox
              class="doc-type"
              [(value)]="document.DocumentTypeId"
              [dataSource]="docTypes$ | async"
              valueExpr="Id"
              displayExpr="Abbreviation"
              label="Doc. Type*"
              name="Doc. Type*"
              [width]="45"
              (selectionChange)="onDocTypeChange($event)"
            >
            </dn-selectbox>

            <dn-selectbox
              [dataSource]="docTypeSeries$ | async"
              valueExpr="Id"
              displayExpr="Prefix"
              label="Doc. Series*"
              [width]="45"
              [(value)]="document.DocumentSeriesId"
              (selectionChange)="onDocSeriesChange($event)"
            >
            </dn-selectbox>
          </div>
          <dn-textbox
            class="tab1-grid-b"
            name="document-code"
            [(value)]="document.DocumentCode"
            label="Code"
            [width]="100"
            [disabled]="docTypeSettings.AutoIncrementCodeEnabled"
          >
          </dn-textbox>

          <dn-date-box
            class="tab1-grid-c"
            name="DocumentDateTime"
            [(value)]="document.DocumentDateTime"
            label="Date*"
            [width]="100"
          >
          </dn-date-box>
          <dn-selectbox
            class="tab1-grid-d"
            name="warehouse"
            [dataSource]="warehouses$ | async"
            valueExpr="Id"
            displayExpr="Name"
            [(value)]="document.WarehouseId"
            label="Warehouse*"
            [width]="100"
          >
          </dn-selectbox>

          @if(this.documentGroup == 1){
          <dn-selectbox
            class="tab1-grid-e"
            [width]="100"
            label="Customer*"
            name="Customer"
            placeholder="Select a Customer"
            [(value)]="document.CustomerId"
            [dataSource]="customers | async"
            valueExpr="Id"
            displayExpr="Name"
            [icon]="'add_circle'"
            (onIconClicked)="onFieldAddIconClicked($event,'customers')"
            (selectionChange)="onCustomerChange($event)"
          ></dn-selectbox>
          } @if(this.documentGroup == 2){
          <dn-selectbox
            class="tab1-grid-e"
            [width]="100"
            label="Supplier*"
            name="Supplier"
            placeholder="Select a Supplier"
            [(value)]="document.SupplierId"
            [dataSource]="suppliers$|async"
            (valueChange)="onSupplierValueChange($event)"
            valueExpr="Id"
            displayExpr="Name"
          ></dn-selectbox>
          }
          <dn-textbox
            class="tab1-grid-f"
            name="phone"
            [(value)]="document.CustomerPhone1"
            label="Phone"
            [width]="100"
          >
          </dn-textbox>
          <dn-selectbox
            class="tab1-grid-l"
            [dataSource]="statusesList$ | async"
            valueExpr="Id"
            displayExpr="Name"
            label="Status*"
            [width]="100"
            [(value)]="document.DocumentStatusId"
            [icon]="'add_circle'"
            (onIconClicked)="onFieldAddIconClicked($event,'statuses')"

          >
          </dn-selectbox>
          <dn-selectbox
            class="tab1-grid-g"
            [dataSource]="shippingMethods$|async"
            valueExpr="Id"
            displayExpr="Name"
            label="Shipping Method"
            [width]="100"
            [(value)]="document.ShippingMethodId"
            [icon]="'add_circle'"
            (onIconClicked)="onFieldAddIconClicked($event,'shipping-methods')"
          >
          </dn-selectbox>
          <dn-selectbox
            class="tab1-grid-h"
            [dataSource]="paymentMethods$|async"
            valueExpr="Id"
            displayExpr="Name"
            label="Payment Method"
            [width]="100"
            [(value)]="document.PaymentMethodId"
            [icon]="'add_circle'"
            (onIconClicked)="onFieldAddIconClicked($event,'payment-methods')"

          >
          </dn-selectbox>
          <dn-selectbox
            class="tab1-grid-j"
            [dataSource]="vatClassesList"
            valueExpr="Id"
            displayExpr="Name"
            label="Vat Class"
            [width]="100"
            [(value)]="document.VatClassId"
            [icon]="'add_circle'"
            (onIconClicked)="onFieldAddIconClicked($event,'vat-classes')"
            (selectionChange)="onVatClassSelectionChanged($event)"
          >
          </dn-selectbox>
        </div>
      </div>
    </mat-tab>
    @if(this.documentGroup == 1){
    <mat-tab label="Shipping Info">
      <div class="tab-2">
        <div class="tab2-grid">
          <dn-textbox
            class="tab2-grid-a-shipping-address"
            name="shipping-address"
            [(value)]="document.ShippingAddress"
            label="Address"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-b-shipping-region"
            name="shipping-region"
            [(value)]="document.ShippingRegion"
            label="Region"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-c-shipping-phone1"
            name="shipping-phone1"
            [(value)]="document.ShippingPhone1"
            label="Phone 1"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-d-shipping-phone2"
            name="shipping-phone2"
            [(value)]="document.ShippingPhone2"
            label="Phone 2"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-e-shipping-city"
            name="shipping-city"
            [(value)]="document.ShippingCity"
            label="City"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-f-postal-code"
            name="shipping-postal-code"
            [(value)]="document.ShippingPostalCode"
            label="Postal Code"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab2-grid-g-shipping-email"
            name="shipping-email"
            [(value)]="document.ShippingEmail"
            label="Email"
            [width]="100"
          >
          </dn-textbox>
        </div>
      </div>
    </mat-tab>
    }
    <mat-tab label="Notes">
      <div class="tab-3">
        <mat-form-field class="notes">
          <mat-label>Notes</mat-label>

          <textarea
            matInput
            cdkTextareaAutosize
            #autosize="cdkTextareaAutosize"
            cdkAutosizeMinRows="7"
            cdkAutosizeMaxRows="15"
            name="notes"
          ></textarea>
        </mat-form-field>
      </div>
    </mat-tab>
    <mat-tab label="User Inputs">
      <div class="tab-4">
        <div class="tab4-grid">
          <dn-textbox
            class="tab4-grid-a-user-text1"
            name="user-text-1"
            [(value)]="document.UserText1"
            label="User Text 1"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab4-grid-b-user-text2"
            name="user-text-2"
            [(value)]="document.UserText2"
            label="User Text 2"
            [width]="100"
          >
          </dn-textbox>

          <dn-textbox
            class="tab4-grid-c-user-text3"
            name="user-text-3"
            [(value)]="document.UserText3"
            label="User Text 3"
            [width]="100"
          >
          </dn-textbox>
          <dn-textbox
            class="tab4-grid-d-user-text4"
            name="user-text-4"
            [(value)]="document.UserText4"
            label="User Text 4"
            [width]="100"
          >
          </dn-textbox>

          <dn-number-box
            class="tab4-grid-e-user-number1"
            name="user-number-1"
            [(value)]="document.UserNumber1"
            label="User Number 1"
            [width]="100"
          >
          </dn-number-box>

          <dn-number-box
            class="tab4-grid-f-user-number2"
            name="user-number-2"
            [(value)]="document.UserNumber2"
            label="User Number 2"
            [width]="100"
          >
          </dn-number-box>

          <dn-number-box
            class="tab4-grid-g-user-number3"
            name="user-number-3"
            [(value)]="document.UserNumber3"
            label="User Number 3"
            [width]="100"
          >
          </dn-number-box>

          <dn-number-box
            class="tab4-grid-h-user-number4"
            name="user-number-4"
            [(value)]="document.UserNumber4"
            label="User Number 4"
            [width]="100"
          >
          </dn-number-box>

          <dn-date-box
            class="tab4-grid-i-user-date1"
            name="user-date-1"
            [(value)]="document.UserDate1"
            label="User Date 1"
            [width]="100"
          >
          </dn-date-box>

          <dn-date-box
            class="tab4-grid-j-user-date2"
            name="user-date-2"
            [(value)]="document.UserDate2"
            label="User Date 2"
            [width]="100"
          >
          </dn-date-box>

          <dn-date-box
            class="tab4-grid-k-user-date3"
            name="user-date-3"
            [(value)]="document.UserDate3"
            label="User Date 3"
            [width]="100"
          >
          </dn-date-box>

          <dn-date-box
            class="tab4-grid-l-user-date4"
            name="user-date-4"
            [(value)]="document.UserDate4"
            label="User Date 4"
            [width]="100"
          >
          </dn-date-box>
        </div>
      </div>
    </mat-tab>
    <mat-tab label="Attachments">
      <div class="tab-5">
        <div class="tab5">
          <dn-file-uploader></dn-file-uploader>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</form>

<div class="margin">
  <div>
    @if(productsDataSource && columns){
    <dn-grid
      class="products-grid"
      #productstable
      tableHeaderBackgroundColor="#0B6AA5"
      tableHeaderFontColor="white"
      [enableAddButton]="true"
      [addButtonText]="'Add Product'"
      [canDisplaySearch]="false"
      [displayPaginator]="false"
      [displayTableBorder]="true"
      [(dataSource)]="productsDataSource"
      [columns]="columns"
      [canEdit]="true"
      (onRowStopEditing)="onProductRowStopEditing($event)"
      (onRowDelete)="onProductRowDelete($event)"
      (onRowSaving)="onProductRowSaving($event)"
    >
    </dn-grid>
    }
    <br />
    <br />
    <div class="edit-document-charges-field">
      <b class="addcharges-title">Additional Charges</b>
      <mat-form-field
        class="addcharges"
        appearance="outline"
        style="width: 120px; height: 20px"
      >
        <input matInput [readonly]="true" [(ngModel)]="addCharges" />
        <button
          matSuffix
          mat-icon-button
          matTooltip="Add charges"
          class="add-charges-btn"
          color="primary"
          (click)="onDocumentAdditionalChargesClicked($event)"
        >
          <mat-icon>add_circle</mat-icon>
        </button>
      </mat-form-field>
      <b class="total-title">Total</b>
      <dn-number-box
        [width]="10"
        [readOnly]="true"
        [(value)]="document.DocumentTotal"
      ></dn-number-box>
    </div>
  </div>
</div>
}

<dn-popup
  *ngIf="isTransformPreparePopupVisible"
  [isPopupVisible]="isTransformPreparePopupVisible"
  [hideOnOutsideClick]="true"
  (onHiding)="onTransformPrepareHiding($event)"
  width="450px"
  height="350px"
  ><dn-toolbar
    [canExit]="true"
    [isDialog]="false"
    (onCloseBtnClicked)="onTransformPrepareHiding($event)"
  ></dn-toolbar>
  <div class="transform-prepare-popup">
    <div class="mb-5 flex">
      <div>
        <button class="button" mat-button>
          <mat-icon class="transorm-prepare-icon">compare_arrows</mat-icon>
        </button>
      </div>
      <div>
        <p>
          {{ document.DocumentCode }} -
          {{ document.DocumentDateTime | date : "dd/MM/yyyy" }}
        </p>
        <p>{{ document.CustomerName }}</p>
      </div>
    </div>
    <div class="tranform-fields-container">
      <div class="mb-5">
        <dn-selectbox
          [dataSource]="docTypeSeries$ | async"
          valueExpr="Id"
          displayExpr="Abbreviation"
          label="Doc. Series"
          [disabled]="true"
          [(value)]="document.DocumentSeriesId"
        >
        </dn-selectbox>
      </div>
      <div class="mb-5">
        <p>
          Select the document series you want the selected document to be
          transformed into:
        </p>
      </div>
      <div>
        <dn-selectbox
          [dataSource]="docTypeSeries$ | async"
          valueExpr="Id"
          displayExpr="Abbreviation"
          label="Doc. Series"
          [(value)]="document.DocumentSeriesId"
        >
        </dn-selectbox>
      </div>
    </div>
    <div class="transform-proceed-btn">
      <button mat-button color="primary">Proceed</button>
    </div>
  </div>
</dn-popup>



@if(isAddEntityPopupVisible){
  <dn-popup
  [isPopupVisible]="isAddEntityPopupVisible"
  [isFullScreen]="true"
  [hideOnOutsideClick]="true"
  (onHiding)="onAddEntityPopupHiding($event)"
  >
  <ng-container [ngSwitch]="activeAddEntity">
    <shipping-methods-list  [isInPopup]="true" *ngSwitchCase="'shipping-methods'" (close)="onAddEntityPopupHiding($event)"></shipping-methods-list>
    <payment-methods-list  [isInPopup]="true" *ngSwitchCase="'payment-methods'" (close)="onAddEntityPopupHiding($event)"></payment-methods-list>
    <vat-classes-list  [isInPopup]="true" *ngSwitchCase="'vat-classes'" (close)="onAddEntityPopupHiding($event)"></vat-classes-list>
    <statuses-list [statusType]="1" [isInPopup]="true" *ngSwitchCase="'statuses'" (close)="onAddEntityPopupHiding($event)"></statuses-list>
    <app-customer-edit [isInPopup]="true" *ngSwitchCase="'customers'" (close)="onAddEntityPopupHiding($event)"></app-customer-edit>
  </ng-container>
</dn-popup>
}
